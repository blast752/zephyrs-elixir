<UserControl x:Class="ZephyrsElixir.Optimize"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:h="clr-namespace:ZephyrsElixir.UI.Helpers"
             Background="Transparent">

    <UserControl.Resources>
        <SolidColorBrush x:Key="Optimize.Brush.StatusIdle" Color="#607D8B"/>
        <SolidColorBrush x:Key="Optimize.Brush.StatusActive" Color="#00E676"/>
        
        <Style x:Key="Optimize.Style.ConsoleHeader" TargetType="Border">
            <Setter Property="Background" Value="#15FFD700"/>
            <Setter Property="Padding" Value="16,10"/>
        </Style>
    </UserControl.Resources>
    
    <Grid Margin="32" ClipToBounds="True">
        <Canvas x:Name="ParticleCanvas" IsHitTestVisible="False"/>
        
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="24"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="24"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <Border Grid.Row="0" Style="{StaticResource App.Style.GlassCard}" 
                    Padding="20,16" Effect="{StaticResource App.Effect.PageShadow}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="16"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <Grid>
                            <Border Width="48" Height="48" CornerRadius="24"
                                    Background="{StaticResource App.Brush.IconCircle}">
                                <Border.Effect>
                                    <DropShadowEffect BlurRadius="12" ShadowDepth="0" 
                                                      Color="{StaticResource App.Color.DeepSkyBlue}" Opacity="0.5"/>
                                </Border.Effect>
                                <TextBlock Text="&#xE8EA;"
                                           Style="{StaticResource App.Style.Glyph}" 
                                           FontSize="22" HorizontalAlignment="Center"/>
                            </Border>
                            <Ellipse x:Name="ConnectionIndicator" Width="14" Height="14" 
                                     Fill="{StaticResource Optimize.Brush.StatusIdle}"
                                     Stroke="#20000000" StrokeThickness="2"
                                     HorizontalAlignment="Right" VerticalAlignment="Bottom"
                                     Margin="0,0,-2,-2">
                                <Ellipse.ToolTip>
                                    <ToolTip Style="{StaticResource App.Style.Tooltip}" 
                                             Content="{h:Translate DeviceStatus_ConnectionStatus_Tooltip}"/>
                                </Ellipse.ToolTip>
                            </Ellipse>
                        </Grid>
                        
                        <StackPanel Margin="14,0,0,0" VerticalAlignment="Center">
                            <TextBlock x:Name="DeviceNameText" Text="{h:Translate DeviceStatus_NoDevice}" 
                                       FontSize="16" FontWeight="SemiBold" Foreground="White"
                                       TextTrimming="CharacterEllipsis" MaxWidth="260"/>
                            
                            <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                                <Border Width="52" Height="20" CornerRadius="10"
                                        Background="#25000000" BorderBrush="#40FFFFFF" BorderThickness="1">
                                    <Border.ToolTip>
                                        <ToolTip Style="{StaticResource App.Style.Tooltip}" 
                                                 Content="{h:Translate Optimize_Battery_Tooltip}"/>
                                    </Border.ToolTip>
                                    <Grid>
                                        <Rectangle x:Name="BatteryFill" RadiusX="8" RadiusY="8" 
                                                   HorizontalAlignment="Left" Margin="2" Width="0" Height="14">
                                            <Rectangle.Fill>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                    <GradientStop Color="#00FF00" Offset="0"/>
                                                    <GradientStop Color="#64FF00" Offset="1"/>
                                                </LinearGradientBrush>
                                            </Rectangle.Fill>
                                        </Rectangle>
                                        <TextBlock x:Name="BatteryText" Text="â€”" FontSize="9" FontWeight="Bold"
                                                   Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Grid>
                                </Border>
                                <TextBlock Text="{h:Translate Optimize_Battery_Label}" Foreground="#90A0B0" FontSize="11" 
                                           VerticalAlignment="Center" Margin="8,0,0,0"/>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                    
                    <Border Grid.Column="1" HorizontalAlignment="Center" VerticalAlignment="Center"
                            Padding="16,8" CornerRadius="12">
                        <Border.Style>
                            <Style TargetType="Border">
                                <Setter Property="Background">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="{StaticResource App.Color.Gold}" Offset="0"/>
                                            <GradientStop Color="#FF8C00" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect BlurRadius="14" ShadowDepth="0" 
                                                          Color="{StaticResource App.Color.Gold}" Opacity="0.45"/>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Border.Style>
                        <Border.ToolTip>
                            <ToolTip Style="{StaticResource App.Style.Tooltip}" 
                                     Content="{h:Translate Optimize_Timer_Tooltip}"/>
                        </Border.ToolTip>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="&#xE916;"
                                       Style="{StaticResource App.Style.Glyph}"
                                       FontSize="16" Foreground="#2A2A2A" Margin="0,0,8,0"/>
                            <TextBlock x:Name="TimerText" Text="00:00:00" 
                                       FontSize="20" FontWeight="Bold" 
                                       FontFamily="Cascadia Code, Consolas"
                                       Foreground="#2A2A2A"/>
                        </StackPanel>
                    </Border>
                    
                    <Button x:Name="DeviceInfoButton" Grid.Column="2"
                            Style="{StaticResource App.Style.Button}"
                            Content="{h:Translate Optimize_Button_DeviceInfo}" Tag="&#xE946;"
                            Click="OnDeviceInfoClick">
                        <Button.ToolTip>
                            <ToolTip Style="{StaticResource App.Style.Tooltip}" 
                                     Content="{h:Translate Optimize_Button_DeviceInfo_Tooltip}"/>
                        </Button.ToolTip>
                    </Button>
                </Grid>
            </Border>

            <Border x:Name="CenterCard" Grid.Row="2"
                    Style="{StaticResource App.Style.GlassCard}"
                    MaxWidth="580" Padding="40,32"
                    VerticalAlignment="Center" HorizontalAlignment="Center"
                    Effect="{StaticResource App.Effect.PageShadow}"
                    RenderTransformOrigin="0.5,0.5">
                <Border.RenderTransform>
                    <ScaleTransform x:Name="CardScale" ScaleX="0" ScaleY="0"/>
                </Border.RenderTransform>
                
                <StackPanel HorizontalAlignment="Center">
                    <Grid Width="84" Height="84" Margin="0,0,0,20" HorizontalAlignment="Center">
                        <Ellipse x:Name="OuterRing" Width="84" Height="84" StrokeThickness="2"
                                 RenderTransformOrigin="0.5,0.5">
                            <Ellipse.Stroke>
                                <LinearGradientBrush>
                                    <GradientStop Color="#00FFD700" Offset="0"/>
                                    <GradientStop Color="#FFFFD700" Offset="0.25"/>
                                    <GradientStop Color="#FF00BFFF" Offset="0.5"/>
                                    <GradientStop Color="#0000BFFF" Offset="0.75"/>
                                    <GradientStop Color="#00FFD700" Offset="1"/>
                                </LinearGradientBrush>
                            </Ellipse.Stroke>
                            <Ellipse.RenderTransform>
                                <RotateTransform x:Name="RingRotation"/>
                            </Ellipse.RenderTransform>
                        </Ellipse>
                        <Border Width="60" Height="60" CornerRadius="30"
                                Background="{StaticResource App.Brush.IconCircle}">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="14" ShadowDepth="0"
                                                  Color="{StaticResource App.Color.DeepSkyBlue}" Opacity="0.6"/>
                            </Border.Effect>
                            <TextBlock Text="&#xE9F5;"
                                       Style="{StaticResource App.Style.Glyph}"
                                       FontSize="28" HorizontalAlignment="Center"/>
                        </Border>
                    </Grid>
                    
                    <TextBlock Text="{h:Translate Optimize_Header}" 
                               FontSize="20" FontWeight="SemiBold" Foreground="White"
                               HorizontalAlignment="Center" Margin="0,0,0,6"/>
                    <TextBlock Text="{h:Translate Optimize_Subtitle}"
                               FontSize="13" Foreground="#90A0B8" TextAlignment="Center"
                               HorizontalAlignment="Center" Margin="0,0,0,20"
                               MaxWidth="380" TextWrapping="Wrap"/>
                    
                    <Grid Width="380" Margin="0,0,0,16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="8"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <Grid Grid.Row="0">
                            <TextBlock x:Name="StepLabel" Text="{h:Translate Optimize_Status_Ready}" 
                                       FontSize="12" Foreground="#80A0B8" HorizontalAlignment="Left"/>
                            <TextBlock x:Name="ProgressText" Text="0%" 
                                       FontSize="12" FontWeight="SemiBold" Foreground="White" 
                                       HorizontalAlignment="Right"/>
                        </Grid>
                        
                        <ProgressBar x:Name="OptimizeProgress" Grid.Row="2"
                                     Style="{StaticResource App.Style.ProgressBar}"
                                     Value="0" Height="20"/>
                    </Grid>
                    
                    <Border Background="#12FFD700" CornerRadius="10" Padding="14,10" Margin="0,4,0,16"
                            BorderBrush="#25FFD700" BorderThickness="1">
                        <Border.ToolTip>
                            <ToolTip Style="{StaticResource App.Style.Tooltip}" MaxWidth="280">
                                <StackPanel>
                                    <TextBlock Text="{h:Translate Optimize_ExtremeMode_Title}" 
                                               FontWeight="SemiBold" Foreground="White" Margin="0,0,0,4"/>
                                    <TextBlock Text="{h:Translate Optimize_ExtremeMode_Description}" 
                                               TextWrapping="Wrap" Foreground="#B0B8C8"/>
                                </StackPanel>
                            </ToolTip>
                        </Border.ToolTip>
                        <CheckBox x:Name="ExtremeModeToggle" h:LicenseGuard.RequiredTier="Pro" Style="{StaticResource App.Style.ToggleSwitch.Extreme}">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE945;" FontFamily="Segoe MDL2 Assets" FontSize="14"
                                           Foreground="{StaticResource App.Brush.Gold}" 
                                           VerticalAlignment="Center" Margin="0,0,10,0">
                                    <TextBlock.Effect>
                                        <DropShadowEffect Color="{StaticResource App.Color.Gold}" 
                                                          BlurRadius="6" ShadowDepth="0" Opacity="0.5"/>
                                    </TextBlock.Effect>
                                </TextBlock>
                                <TextBlock Text="{h:Translate Optimize_ExtremeMode_Label}" FontSize="12" FontWeight="SemiBold" 
                                           Foreground="#C8D0E0" VerticalAlignment="Center"/>
                            </StackPanel>
                        </CheckBox>
                    </Border>
                    
                    <Button x:Name="OptimizeButton" 
                            Style="{StaticResource App.Style.Button}"
                            Content="{h:Translate Optimize_Button_Start}" Tag="&#xE768;"
                            MinWidth="200" MinHeight="52"
                            Click="OnOptimizeClick">
                        <Button.ToolTip>
                            <ToolTip Style="{StaticResource App.Style.Tooltip}" 
                                     Content="{h:Translate Optimize_Button_Start_Tooltip}"/>
                        </Button.ToolTip>
                    </Button>
                </StackPanel>
            </Border>

            <Border Grid.Row="4" CornerRadius="12" MaxHeight="160" ClipToBounds="True"
                    Background="#30000000" BorderBrush="#30FFD700" BorderThickness="1">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <Border Style="{StaticResource Optimize.Style.ConsoleHeader}">
                        <Grid>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE756;" Style="{StaticResource App.Style.Glyph}"
                                           FontSize="13" Foreground="{StaticResource App.Brush.Gold}" Margin="0,0,8,0">
                                    <TextBlock.Effect>
                                        <DropShadowEffect Color="{StaticResource App.Color.Gold}" 
                                                          BlurRadius="6" ShadowDepth="0" Opacity="0.5"/>
                                    </TextBlock.Effect>
                                </TextBlock>
                                <TextBlock Text="{h:Translate Optimize_Console_Header}" FontSize="12" FontWeight="SemiBold" 
                                           Foreground="#C8D0E0" VerticalAlignment="Center"/>
                            </StackPanel>
                            
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                                <Ellipse x:Name="ConsoleStatusDot" Width="6" Height="6" 
                                         Fill="#607D8B" Margin="0,0,6,0"/>
                                <TextBlock x:Name="ConsoleStatusText" Text="{h:Translate Optimize_Console_Status_Idle}" 
                                           FontSize="10" Foreground="#708090"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                    
                    <TextBox x:Name="TerminalBox" Grid.Row="1" 
                             Margin="12,8" IsReadOnly="True"
                             VerticalScrollBarVisibility="Auto" TextWrapping="Wrap"
                             Background="Transparent" Foreground="#A8C0E0"
                             FontFamily="Cascadia Code, Consolas" FontSize="11"
                             BorderThickness="0" CaretBrush="{StaticResource App.Brush.Gold}"/>
                </Grid>
            </Border>
        </Grid>
    </Grid>
    
    <UserControl.Triggers>
        <EventTrigger RoutedEvent="Loaded">
            <BeginStoryboard>
                <Storyboard>
                    <DoubleAnimation Storyboard.TargetName="CardScale"
                                     Storyboard.TargetProperty="ScaleX"
                                     From="0" To="1" Duration="0:0:0.45"
                                     EasingFunction="{StaticResource App.Easing.Bounce}"/>
                    <DoubleAnimation Storyboard.TargetName="CardScale"
                                     Storyboard.TargetProperty="ScaleY"
                                     From="0" To="1" Duration="0:0:0.45"
                                     EasingFunction="{StaticResource App.Easing.Bounce}"/>
                    <DoubleAnimation Storyboard.TargetName="RingRotation"
                                     Storyboard.TargetProperty="Angle"
                                     From="0" To="360" Duration="0:0:5"
                                     RepeatBehavior="Forever"/>
                </Storyboard>
            </BeginStoryboard>
        </EventTrigger>
    </UserControl.Triggers>
</UserControl>